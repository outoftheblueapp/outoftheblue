<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Back Office</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 0; }
      #boot { padding: 24px; }
      .muted { opacity: .7; font-size: 14px; }
      pre { background:#f6f8fa; padding:12px; overflow:auto; }
    </style>

    <!-- helpful logging so a blank page isn't mysterious -->
    <script>
      (function () {
        const log = (...a) => { try { console.log('[admin]', ...a); } catch(e){} };
        window.__adminLog = log;
        window.addEventListener('error', e => log('window error:', e.message));
      })();
    </script>

    <!-- Try unpkg first; if it fails, load jsDelivr -->
    <script src="https://unpkg.com/decap-cms-app@^3/dist/decap-cms.js"
            onload="__adminLog('Decap CMS loaded from unpkg'); window.__decapLoaded = true;"
            onerror="(function(){
              __adminLog('unpkg failed, trying jsDelivr…');
              var s=document.createElement('script');
              s.src='https://cdn.jsdelivr.net/npm/decap-cms-app@3/dist/decap-cms.js';
              s.onload=function(){__adminLog('Decap CMS loaded from jsDelivr'); window.__decapLoaded=true; try{CMS.init();}catch(e){__adminLog('CMS.init error (jsDelivr):', e)}};
              document.head.appendChild(s);
            })()">
    </script>
  </head>
  <body>
    <div id="boot">
      <h1>Back Office</h1>
      <div class="muted">Loading editor… If this stays here, press F12 → Console for errors.</div>
      <div id="err"></div>
      <script>
        (function waitForCMS(){
          if (window.__decapLoaded && window.CMS) {
            try { CMS.init(); __adminLog('CMS.init called'); }
            catch (e) {
              __adminLog('CMS.init error (unpkg):', e);
              document.getElementById('err').innerHTML =
                '<p><strong>Init error:</strong> '+(e && e.message || e)+'</p>';
            }
            return;
          }
          setTimeout(waitForCMS, 200);
        })();
      </script>
      <details style="margin-top:16px"><summary class="muted">Config URL</summary>
        <pre>/admin/config.yml</pre>
      </details>
    </div>
  </body>
</html>
<!-- Netlify Identity widget: handles invite/login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  // complete invite links automatically and return to /admin
  if (location.hash && /invite_token=/.test(location.hash) && window.netlifyIdentity) {
    window.netlifyIdentity.acceptInvite().then(() => location.replace('/admin/'));
  }
  // refresh page when logging in/out so CMS sees the token
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on('login', () => location.reload());
    window.netlifyIdentity.on('logout', () => location.reload());
  }
</script>


